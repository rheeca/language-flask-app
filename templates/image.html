{% extends "layout.html" %}
{% block content %}
<div class="d-flex justify-content-between">
    <form action="/">
        <input type="submit" value="Choose another image" class="btn btn-outline-secondary">
    </form>
    <button onclick="" class="btn btn-info">Save Words</button>
</div>
<br />

{% for word, val in words.items() %}
<div class="word-section">
    <p>{{ word }}</p>
    <p id="translation-{{ loop.index }}"></p>
    <button onclick="handleTranslate(event, '{{ loop.index }}', '{{ word }}')"
        class="btn btn-outline-info">Translate</button>
</div>
{% endfor %}
<br />
<img src="data:image/jpeg;base64,{{image}}" style="width:700px">
<script>
    async function handleTranslate(event, index, word) {
        const response = await fetch("/translate", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ word: word })
        });

        const data = await response.json();
        document.getElementById(`translation-${index}`).innerHTML = data.result;

        // Replace Translate button with Add button after translation
        const button = event.target;
        button.innerText = "Add";
        button.setAttribute("onclick", `handleAdd(event, '${index}', '${word}', '${data.result}')`);
    }

    async function handleAdd(event, index, word, translation) {
        const response = await fetch("/add", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ word: word, translation: translation })
        });

        // Disable Add button after adding
        const button = event.target;
        button.innerHTML = 'Added <i class="bi bi-check-circle-fill"></i>';
        button.disabled = true;
    }
</script>
{% endblock content %}